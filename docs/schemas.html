<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2021-12-02T11:44:49.800817"><meta name="build-number" content="222">    <meta name="keywords" content="">   <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-5P98');</script><script src="https://resources.jetbrains.com/storage/help-app/v3/analytics.js"></script>  <title>Working with Data Schemas | Dataframe</title>   <link href="https://resources.jetbrains.com/storage/help-app/v3/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Working with Data Schemas | Dataframe"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="Dataframe Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://kotlin.github.io/dataframe//0.8/schemas.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Working with Data Schemas | Dataframe"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://kotlin.github.io/dataframe//0.8/schemas.html#webpage", "url": "https://kotlin.github.io/dataframe//0.8/schemas.html", "name": "Working with Data Schemas | Dataframe", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://kotlin.github.io/dataframe/#website", "url": "https://kotlin.github.io/dataframe/", "name": "Dataframe Help" }</script><!-- End Schema.org --></head>    <body data-id="schemas" data-main-title="Working with Data Schemas" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="overview.md|Overview"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Dataframe 0.8 Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">  </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="schemas" id="schemas.md"  >Working with Data Schemas</h1><p id="c412c0e7" >In Jupyter environment <code class="code "   >DataFrame</code> provides typed data access by automatic inference of <code class="code "   >DataSchema</code> of new <code class="code "   >DataFrame</code> instances and generation of schema-specific extension properties</p><section class="chapter"  ><h2 id="overview" data-toc="schemas#overview"  >Overview</h2><p id="a5b739e8" >After execution of cell</p><div class="code-block" data-lang="kotlin"          >val df = dataFrameOf(&quot;name&quot;, &quot;age&quot;)(
    &quot;Alice&quot;, 15,
    &quot;Bob&quot;, null
)
</div><p id="69f74e60" >the following actions take place:</p><ol class="list _decimal" id="9656cc0b"   ><li class="list__item" id="2056f0e" ><p>Columns in <code class="code "   >df</code> are analyzed to extract data schema</p></li><li class="list__item" id="2dbd6621" ><p>Empty interface with <code class="code "   >DataSchema</code> annotation is generated:</p></li></ol><div class="code-block" data-lang="kotlin"          >@DataSchema
interface DataFrameType
</div><ol class="list _decimal" id="29a6fe0a"   start="3"><li class="list__item" id="b956f007" ><p>Extension properties for this <code class="code "   >DataSchema</code> are generated:</p></li></ol><div class="code-block" data-lang="kotlin"          >val ColumnsContainer&lt;DataFrameType&gt;.age: DataColumn&lt;Int?&gt; @JvmName(&quot;DataFrameType_age&quot;) get() = this[&quot;age&quot;] as DataColumn&lt;Int?&gt;
val DataRow&lt;DataFrameType&gt;.age: Int? @JvmName(&quot;DataFrameType_age&quot;) get() = this[&quot;age&quot;] as Int?
val ColumnsContainer&lt;DataFrameType&gt;.name: DataColumn&lt;String&gt; @JvmName(&quot;DataFrameType_name&quot;) get() = this[&quot;name&quot;] as DataColumn&lt;String&gt;
val DataRow&lt;DataFrameType&gt;.name: String @JvmName(&quot;DataFrameType_name&quot;) get() = this[&quot;name&quot;] as String
</div><p id="deb46301" >Every column produces two extension properties:</p><ul class="list _ul" id="d77a7940"   ><li class="list__item" id="79c3dd4f" ><p>Property for <code class="code "   >ColumnsContainer&lt;DataFrameType&gt;</code> returns column</p></li><li class="list__item" id="cd5b92cc" ><p>Property for <code class="code "   >DataRow&lt;DataFrameType&gt;</code> returns cell value</p></li></ul><ol class="list _decimal" id="3ec19fdf"   start="4"><li class="list__item" id="7852a7f0" ><p><code class="code "   >df</code> variable is typed by schema interface:</p></li></ol><div class="code-block" data-lang="kotlin"          >val temp = df
</div><div class="code-block" data-lang="kotlin"          >val df = temp.cast&lt;DataFrameType&gt;()
</div><aside data-type="tip" class="prompt" data-title="" id="71db133d" ><p id="82327f16" ><em id="3d99fce8" class=""  >Note, that object instance after casting remains the same</em></p></aside><p id="d045aca7" >To log all these additional code executions, use cell magic</p><p> <code class="code "   >%trackExecution -all</code></p></section><section class="chapter"  ><h2 id="schema-inheritance" data-toc="schemas#schema-inheritance"  >Schema inheritance</h2><p id="1736d7e4" >In order to reduce amount of generated code, previously generated <code class="code "   >DataSchema</code> interfaces are reused and only new properties are introduced</p><p id="c24626fd" >Let's filter out all <code class="code "   >null</code> values from <code class="code "   >age</code> column and add one more column of type <code class="code "   >Boolean</code>:</p><div class="code-block" data-lang="kotlin"          >val filtered = df.filter { age != null }.add(&quot;isAdult&quot;) { age!! &gt; 18 }
</div><p id="11889172" >New schema interface for <code class="code "   >filtered</code> variable will be derived from previously generated <code class="code "   >DataFrameType</code>:</p><div class="code-block" data-lang="kotlin"          >@DataSchema
interface DataFrameType1: DataFrameType
</div><p id="b35ea351" >Extension properties for data access are generated only for new and overriden members of <code class="code "   >DataFrameType1</code> interface:</p><div class="code-block" data-lang="kotlin"          >val ColumnsContainer&lt;DataFrameType1&gt;.age: DataColumn&lt;Int&gt; get() = this[&quot;age&quot;] as DataColumn&lt;Int&gt;
val DataRow&lt;DataFrameType1&gt;.age: Int get() = this[&quot;age&quot;] as Int
val ColumnsContainer&lt;DataFrameType1&gt;.isAdult: DataColumn&lt;Boolean&gt; get() = this[&quot;isAdult&quot;] as DataColumn&lt;Boolean&gt;
val DataRow&lt;DataFrameType1&gt;.isAdult: String get() = this[&quot;isAdult&quot;] as Boolean
</div><p id="357bb799" >Then variable <code class="code "   >filtered</code> is typed by new interface:</p><div class="code-block" data-lang="kotlin"          >val temp = filtered
</div><div class="code-block" data-lang="kotlin"          >val filtered = temp as DataFrame&lt;DataFrameType1&gt;
</div></section><section class="chapter"  ><h2 id="custom-data-schemas" data-toc="schemas#custom-data-schemas"  >Custom data schemas</h2><p id="d1683d35" >Besides auto-generated schema interfaces, you can explicitly define your own data schema:</p><div class="code-block" data-lang="kotlin"          >@DataSchema
interface Person {
    val name: String
    val age: Int 
}
</div><p id="d3d23519" >After execution of this cell in Jupyter, extension properties for data access will be generated. Now we can use these properties to create functions for typed <code class="code "   >DataFrame</code>:</p><div class="code-block" data-lang="kotlin"          >fun DataFrame&lt;Person&gt;.splitName() = split { name }.by(&quot;,&quot;).into(&quot;firstName&quot;, &quot;lastName&quot;)
fun DataFrame&lt;Person&gt;.adults() = filter { age &gt; 18 }
</div><p id="89cea693" >These functions will work for any <code class="code "   >DataFrame</code> that matches <code class="code "   >Person</code> schema:</p><div class="code-block" data-lang="kotlin"          >val df = dataFrameOf(&quot;name&quot;, &quot;age&quot;, &quot;weight&quot;)(
    &quot;Merton, Alice&quot;, 15, 60.0,
    &quot;Marley, Bob&quot;, 20, 73.5
)
</div><p id="f9674a14" >Schema of <code class="code "   >df</code> is compatible with <code class="code "   >Person</code>, so auto-generated schema interface will inherit from it:</p><div class="code-block" data-lang="kotlin"          >@DataSchema(isOpen = false)
interface DataFrameType : Person
val DataFrameBase&lt;DataFrameType&gt;.age: DataColumn&lt;Double&gt; get() = this[&quot;weight&quot;] as DataColumn&lt;Double&gt;
val DataRowBase&lt;DataFrameType&gt;.age: Double get() = this[&quot;weight&quot;] as Int
</div><p id="5ab147e5" >Despite <code class="code "   >df</code> has additional column <code class="code "   >weight</code>, previously defined functions for <code class="code "   >DataFrame&lt;Person&gt;</code> work for it:</p><div class="code-block" data-lang="kotlin"          >df.splitName()
</div><div class="code-block" data-lang="plaintext"          >   firstName lastName age weight
 0    Merton    Alice  15 60.000
 1    Marley      Bob  20 73.125
</div><div class="code-block" data-lang="kotlin"          >df.adults()
</div><div class="code-block" data-lang="plaintext"          >          name age weight
 0 Marley, Bob  20   73.5
</div></section><section class="chapter"  ><h2 id="use-external-data-schemas-in-jupyter" data-toc="schemas#use-external-data-schemas-in-jupyter"  >Use external data schemas in Jupyter</h2><p id="90c51b8f" >Sometimes it is convenient to extract reusable code from Jupyter notebook into Kotlin JVM library. If this code uses <a href="#custom-data-schemas" id="46508a0d"   >Custom data schemas</a>, schema interfaces should also be extracted. In order to enable support them in Jupyter, you should register them in library <a href="https://github.com/Kotlin/kotlin-jupyter/blob/master/docs/libraries.md" id="333460b6"   data-external="true" rel="noopener noreferrer" >integration class</a> with <code class="code "   >useSchema</code> function:</p><div class="code-block" data-lang="kotlin"          >@DataSchema
interface Person {
    val name: String
    val age: Int 
}

fun DataFrame&lt;Person&gt;.countAdults() = count { it[Person::age] &gt; 18 }

@JupyterLibrary
internal class Integration : JupyterIntegration() {
    
    override fun Builder.onLoaded() {
        onLoaded {
            useSchema&lt;Person&gt;()
        }
    }
}
</div><p id="69d81846" >After loading this library into Jupyter notebook, schema interfaces for all <code class="code "   >DataFrame</code> variables that match <code class="code "   >Person</code> schema will derive from <code class="code "   >Person</code></p><div class="code-block" data-lang="kotlin"          >val df = dataFrameOf(&quot;name&quot;, &quot;age&quot;)(
    &quot;Alice&quot;, 15,
    &quot;Bob&quot;, null
)
</div><p id="40d2a689" >Now <code class="code "   >df</code> is assignable to <code class="code "   >DataFrame&lt;Person&gt;</code> and <code class="code "   >countAdults</code> is available:</p><div class="code-block" data-lang="kotlin"          >df.countAdults()
</div></section><div class="last-modified"> Last modified: 30 November 2021</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="hierarchical.html">Hierarchical data structures</a>   <a class="navigation-links__next" href="gradle.html">Working with Data Schemas in Gradle project</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>